<!DOCTYPE html>
<html lang="<%= locale %>">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= __('profile_title') %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="/styles/Profile.css" />
  <link rel="stylesheet" href="/styles/Header.css" />
  <link rel="stylesheet" href="/styles/Buttons.css" />
  <link rel="stylesheet" href="/styles/Footer.css" />
  <%- include('./partials/favicon') %>
</head>
<body>
  <%- include('./partials/header'); %>

  <main>
    <div class="container py-4">
      <div class="row g-4">
        <div class="col-md-12">
          <div class="profile-section">
            <div class="profile-header d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center gap-4">
                <div class="profile-avatar">
                  <% if (avatar) { %>
                    <img src="<%= avatar %>" alt="Avatar" class="img-fluid rounded-circle">
                  <% } else { %>
                    <div class="avatar-fallback d-flex justify-content-center align-items-center rounded-circle bg-secondary text-white" style="width: 100px; height: 100px; font-size: 36px;">
                      <%= user.initials %>
                    </div>
                  <% } %>
                </div>
                <div>
                  <h2><%= user.name %></h2>
                  <p class="mb-0 text-muted">
                    <%= __('joined') %>: 
                    <span id="joinedDate" data-date="<%= user.created_at %>"></span>
                  </p>
                </div>
              </div>
            </div>

            <div class="border-bottom mb-3 mt-3">
              <nav class="nav nav-tabs">
                <a href="#profile" class="nav-link active" data-bs-toggle="tab"><%= __('profile_tab') %></a>
                <a href="#orders" class="nav-link" data-bs-toggle="tab"><%= __('orders_tab') %></a>
                <a href="#cart" class="nav-link" data-bs-toggle="tab"><%= __('cart_tab') %></a>
              </nav>
            </div>

            <div class="tab-content">
              <div id="profile" class="tab-pane fade show active">
                <form id="profileForm" enctype="multipart/form-data">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label"><%= __('email') %></label>
                      <input type="email" 
                             name="email" 
                             class="form-control editable-input" 
                             value="<%= user.email %>" 
                             pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                             title="<%= __('email_validation_message') %>"
                             readonly>
                      <div class="invalid-feedback"></div>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label"><%= __('phone') %></label>
                      <input type="tel" 
                             name="phone" 
                             class="form-control editable-input" 
                             value="<%= user.phone %>" 
                             pattern="^\+?[1-9][0-9]{7,14}$"
                             title="<%= __('phone_validation_message') %>"
                             readonly>
                      <div class="invalid-feedback"></div>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label"><%= __('address') %></label>
                      <input type="text" 
                             name="adress" 
                             class="form-control editable-input" 
                             value="<%= user.adress %>" 
                             minlength="5"
                             maxlength="200"
                             title="<%= __('address_validation_message') %>"
                             readonly>
                      <div class="invalid-feedback"></div>
                    </div>
                    <div class="col-md-6">
                      <label for="avatar" class="form-label"><%= __('change_avatar') %></label>
                      <input type="file" name="avatar" id="avatar" accept="image/*" class="form-control">
                      <button type="button" id="uploadAvatarBtn" class="btn">
                        <%= __('upload') %>
                      </button>
                      <div class="progress d-none mt-2" id="avatarUploadProgress">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                      </div>
                    </div>
                  </div>

                  <div class="d-flex gap-2 mt-3">
                    <button id="editBtn" class="btn" type="button"><%= __('edit') %></button>
                    <button type="submit" id="saveBtn" class="btn d-none"><%= __('save') %></button>
                    <button type="button" id="cancelBtn" class="btn d-none"><%= __('cancel') %></button>
                  </div>
                </form>
              </div>

              <div id="cart" class="tab-pane fade">
                <div id="cartMessages"></div>
                <div id="cartContent">
                  <div class="text-center mt-4">
                    <p class="mb-3"><%= __('loading_cart') %></p>
                  </div>
                </div>
              </div>

              <div id="orders" class="tab-pane fade">
                <div id="ordersMessages"></div>
                <div id="ordersContent">
                  <div class="text-center mt-4">
                    <p class="mb-3"><%= __('loading_orders') %></p>
                  </div>
                </div>
              </div>
            </div>

            <div id="statusMessage" class="alert d-none mt-3" role="alert"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <%- include('./partials/footer'); %>

  <!-- Initialize data for profile.js -->
  <script>
    // Make user data and translations available to profile.js
    window.profileData = {
      userData: JSON.parse('<%- JSON.stringify(user) %>'),
      locale: '<%= locale %>',
      translations: {
        email_validation_message: '<%= __("email_validation_message") %>',
        phone_validation_message: '<%= __("phone_validation_message") %>',
        address_validation_message: '<%= __("address_validation_message") %>',
        validation_error: '<%= __("validation_error") %>',
        email_exists: '<%= __("email_exists") %>',
        invalid_email: '<%= __("invalid_email") %>',
        invalid_phone: '<%= __("invalid_phone") %>',
        invalid_address: '<%= __("invalid_address") %>',
        status_pending: '<%= __("status_pending") %>',
        status_processing: '<%= __("status_processing") %>',
        status_completed: '<%= __("status_completed") %>',
        status_cancelled: '<%= __("status_cancelled") %>',
        payment_status_completed: '<%= __("payment_status_completed") %>',
        payment_status_pending: '<%= __("payment_status_pending") %>',
        payment_status_failed: '<%= __("payment_status_failed") %>',
        currency_symbol: '<%= __("currency_symbol") %>',
        loading_cart: '<%= __("loading_cart") %>',
        loading_orders: '<%= __("loading_orders") %>',
        error_loading_cart: '<%= __("error_loading_cart") %>',
        error_loading_orders: '<%= __("error_loading_orders") %>',
        your_cart_is_empty: '<%= __("your_cart_is_empty") %>',
        browse_services: '<%= __("browse_services") %>',
        option_filename: '<%= __("option_filename") %>',
        option_pages: '<%= __("option_pages") %>',
        option_color: '<%= __("option_color") %>',
        option_paper_size: '<%= __("option_paper_size") %>',
        option_double_sided: '<%= __("option_double_sided") %>',
        pages_all: '<%= __("pages_all") %>',
        color_black_white: '<%= __("color_black_white") %>',
        color_color: '<%= __("color_color") %>',
        double_sided_yes: '<%= __("double_sided_yes") %>',
        double_sided_no: '<%= __("double_sided_no") %>',
        paper_size_a4: '<%= __("paper_size_a4") %>',
        paper_size_a3: '<%= __("paper_size_a3") %>',
        paper_size_letter: '<%= __("paper_size_letter") %>',
        custom_tshirt: '<%= __("custom_tshirt") %>',
        custom_tshirt_desc: '<%= __("custom_tshirt_desc") %>',
        option_size: '<%= __("option_size") %>',
        size_small: '<%= __("size_small") %>',
        size_medium: '<%= __("size_medium") %>',
        size_large: '<%= __("size_large") %>',
        size_xl: '<%= __("size_xl") %>',
        size_2xl: '<%= __("size_2xl") %>'
      }
    };
  </script>

  <script src="/scripts/profile.js"></script>
</body>
</html>
